import { md5 } from "./md5.js";
import {
  bin_and,
  bin_not,
  bin_or,
  bin_rotate_left,
  bin_sum_mod_32,
  bin_xor
} from "./bitwise-operations.js";

describe("md5 dependencies", () => {
  it("binary and operator", () => {
    let a = "1010101010", b = "11101";
    expect(bin_and(a, b)).toBe("0000001000");
  });
  it("binary or operator", () => {
    let a = "1010101010", b = "11101";
    expect(bin_or(a, b)).toBe("1010111111");
  });
  it("binary xor operator", () => {
    let a = "1010101010", b = "11101";
    expect(bin_xor(a, b)).toBe("1010110111");
  });
  it("binary rotate_left operator", () => {
    let a = "100010011";
    expect(bin_rotate_left(a, 3)).toBe("010011100");
  });
  it("binary sum_mod_32 operator", () => {
    let a = "10101100101100010111100100011010",
      b = "10000100100101110101100011111111";

    expect(bin_sum_mod_32(a, b)).toBe("00110001010010001101001000011001");
  });
  it("binary not operator", () => {
    let a = "10101010";
    expect(bin_not(a)).toBe("01010101");
  });
});

describe("md5 main algorithm", () => {
  it("md5 of empty string", () => {
    let str = "",
      out = {
        result: 'd41d8cd98f00b204e9800998ecf8427e',
        procedure: [
          1,
          [ 1732584193, 4023233417, 2562383102, 271733878 ],
          [ 271733878, 2770347892, 4023233417, 2562383102 ],
          [ 2562383102, 4120220381, 2770347892, 4023233417 ],
          [ 4023233417, 3891292963, 4120220381, 2770347892 ],
          [ 2770347892, 454439427, 3891292963, 4120220381 ],
          [ 4120220381, 839070532, 454439427, 3891292963 ],
          [ 3891292963, 792056980, 839070532, 454439427 ],
          [ 454439427, 4122040539, 792056980, 839070532 ],
          [ 839070532, 2613132521, 4122040539, 792056980 ],
          [ 792056980, 949205393, 2613132521, 4122040539 ],
          [ 4122040539, 4242842386, 949205393, 2613132521 ],
          [ 2613132521, 3790538102, 4242842386, 949205393 ],
          [ 949205393, 1886816809, 3790538102, 4242842386 ],
          [ 4242842386, 4117527793, 1886816809, 3790538102 ],
          [ 3790538102, 927548327, 4117527793, 1886816809 ],
          [ 1886816809, 1520779125, 927548327, 4117527793 ],
          [ 4117527793, 3598818410, 1520779125, 927548327 ],
          [ 927548327, 477984019, 3598818410, 1520779125 ],
          [ 1520779125, 2077588026, 477984019, 3598818410 ],
          [ 3598818410, 3231052090, 2077588026, 477984019 ],
          [ 477984019, 3178769943, 3231052090, 2077588026 ],
          [ 2077588026, 1025392236, 3178769943, 3231052090 ],
          [ 3231052090, 1756869603, 1025392236, 3178769943 ],
          [ 3178769943, 3946931262, 1756869603, 1025392236 ],
          [ 1025392236, 3827454746, 3946931262, 1756869603 ],
          [ 1756869603, 812564770, 3827454746, 3946931262 ],
          [ 3946931262, 3532421058, 812564770, 3827454746 ],
          [ 3827454746, 2747687898, 3532421058, 812564770 ],
          [ 812564770, 2690066439, 2747687898, 3532421058 ],
          [ 3532421058, 326135862, 2690066439, 2747687898 ],
          [ 2747687898, 2927104987, 326135862, 2690066439 ],
          [ 2690066439, 473023364, 2927104987, 326135862 ],
          [ 326135862, 2720030495, 473023364, 2927104987 ],
          [ 2927104987, 3747867297, 2720030495, 473023364 ],
          [ 473023364, 3278413659, 3747867297, 2720030495 ],
          [ 2720030495, 317974357, 3278413659, 3747867297 ],
          [ 3747867297, 4941417, 317974357, 3278413659 ],
          [ 3278413659, 1601870638, 4941417, 317974357 ],
          [ 317974357, 2881703446, 1601870638, 4941417 ],
          [ 4941417, 2445954231, 2881703446, 1601870638 ],
          [ 1601870638, 3319565333, 2445954231, 2881703446 ],
          [ 2881703446, 1150752413, 3319565333, 2445954231 ],
          [ 2445954231, 1996329940, 1150752413, 3319565333 ],
          [ 3319565333, 4254462531, 1996329940, 1150752413 ],
          [ 1150752413, 266544211, 4254462531, 1996329940 ],
          [ 1996329940, 1062596093, 266544211, 4254462531 ],
          [ 4254462531, 581115732, 1062596093, 266544211 ],
          [ 266544211, 1759006370, 581115732, 1062596093 ],
          [ 1062596093, 3397201341, 1759006370, 581115732 ],
          [ 581115732, 2477401463, 3397201341, 1759006370 ],
          [ 1759006370, 378068101, 2477401463, 3397201341 ],
          [ 3397201341, 3448092875, 378068101, 2477401463 ],
          [ 2477401463, 1444808329, 3448092875, 378068101 ],
          [ 378068101, 1445306644, 1444808329, 3448092875 ],
          [ 3448092875, 877720619, 1445306644, 1444808329 ],
          [ 1444808329, 959107280, 877720619, 1445306644 ],
          [ 1445306644, 511179361, 959107280, 877720619 ],
          [ 877720619, 1196072076, 511179361, 959107280 ],
          [ 959107280, 3754819772, 1196072076, 511179361 ],
          [ 511179361, 911821588, 3754819772, 1196072076 ],
          [ 1196072076, 806551938, 911821588, 3754819772 ],
          [ 3754819772, 1917254355, 806551938, 911821588 ],
          [ 911821588, 1846584438, 1917254355, 806551938 ],
          [ 806551938, 4283343851, 1846584438, 1917254355 ]
        ]
      }

    expect(md5(str)).toEqual(out);
  });
  it("md5 of 'the quick brown fox jumps over the lazy dog.'", () => {
    let str = "The quick brown fox jumps over the lazy dog.",
      out = {
        result: 'e4d909c290d0fb1ca068ffaddf22cbd0',
        procedure: [
          1,
          [ 1732584193, 4023233417, 2562383102, 271733878 ],
          [ 271733878, 3620999556, 4023233417, 2562383102 ],
          [ 2562383102, 4240933961, 3620999556, 4023233417 ],
          [ 4023233417, 810521180, 4240933961, 3620999556 ],
          [ 3620999556, 469894840, 810521180, 4240933961 ],
          [ 4240933961, 1678475303, 469894840, 810521180 ],
          [ 810521180, 2435898551, 1678475303, 469894840 ],
          [ 469894840, 2270401177, 2435898551, 1678475303 ],
          [ 1678475303, 1018114816, 2270401177, 2435898551 ],
          [ 2435898551, 2631778911, 1018114816, 2270401177 ],
          [ 2270401177, 2196912166, 2631778911, 1018114816 ],
          [ 1018114816, 1146821972, 2196912166, 2631778911 ],
          [ 2631778911, 2545079821, 1146821972, 2196912166 ],
          [ 2196912166, 4156205459, 2545079821, 1146821972 ],
          [ 1146821972, 3684338458, 4156205459, 2545079821 ],
          [ 2545079821, 1515065400, 3684338458, 4156205459 ],
          [ 4156205459, 1288067225, 1515065400, 3684338458 ],
          [ 3684338458, 2379345004, 1288067225, 1515065400 ],
          [ 1515065400, 2736838826, 2379345004, 1288067225 ],
          [ 1288067225, 1025382681, 2736838826, 2379345004 ],
          [ 2379345004, 1328970307, 1025382681, 2736838826 ],
          [ 2736838826, 3301958433, 1328970307, 1025382681 ],
          [ 1025382681, 3125750612, 3301958433, 1328970307 ],
          [ 1328970307, 2769146743, 3125750612, 3301958433 ],
          [ 3301958433, 3010407554, 2769146743, 3125750612 ],
          [ 3125750612, 2194906617, 3010407554, 2769146743 ],
          [ 2769146743, 1454937112, 2194906617, 3010407554 ],
          [ 3010407554, 3526510426, 1454937112, 2194906617 ],
          [ 2194906617, 2502293908, 3526510426, 1454937112 ],
          [ 1454937112, 2960212908, 2502293908, 3526510426 ],
          [ 3526510426, 823743074, 2960212908, 2502293908 ],
          [ 2502293908, 4106848806, 823743074, 2960212908 ],
          [ 2960212908, 2098643899, 4106848806, 823743074 ],
          [ 823743074, 386378040, 2098643899, 4106848806 ],
          [ 4106848806, 998190932, 386378040, 2098643899 ],
          [ 2098643899, 1830740777, 998190932, 386378040 ],
          [ 386378040, 2742883418, 1830740777, 998190932 ],
          [ 998190932, 3897238939, 2742883418, 1830740777 ],
          [ 1830740777, 3797255178, 3897238939, 2742883418 ],
          [ 2742883418, 957285736, 3797255178, 3897238939 ],
          [ 3897238939, 3438338138, 957285736, 3797255178 ],
          [ 3797255178, 1442920940, 3438338138, 957285736 ],
          [ 957285736, 764079734, 1442920940, 3438338138 ],
          [ 3438338138, 312988765, 764079734, 1442920940 ],
          [ 1442920940, 3749731949, 312988765, 764079734 ],
          [ 764079734, 4014926640, 3749731949, 312988765 ],
          [ 312988765, 1855571174, 4014926640, 3749731949 ],
          [ 3749731949, 833246599, 1855571174, 4014926640 ],
          [ 4014926640, 4178434990, 833246599, 1855571174 ],
          [ 1855571174, 567729121, 4178434990, 833246599 ],
          [ 833246599, 523485395, 567729121, 4178434990 ],
          [ 4178434990, 4229156484, 523485395, 567729121 ],
          [ 567729121, 4024217959, 4229156484, 523485395 ],
          [ 523485395, 2957415757, 4024217959, 4229156484 ],
          [ 4229156484, 879379960, 2957415757, 4024217959 ],
          [ 4024217959, 3136789828, 879379960, 2957415757 ],
          [ 2957415757, 2448173387, 3136789828, 879379960 ],
          [ 879379960, 3629378886, 2448173387, 3136789828 ],
          [ 3136789828, 337780547, 3629378886, 2448173387 ],
          [ 2448173387, 769678503, 337780547, 3629378886 ],
          [ 3629378886, 3403928822, 769678503, 337780547 ],
          [ 337780547, 1522841315, 3403928822, 769678503 ],
          [ 769678503, 3231239785, 1522841315, 3403928822 ],
          [ 3403928822, 356813730, 3231239785, 1522841315 ]
        ]
      };
    expect(md5(str)).toEqual(out);
  });
});
